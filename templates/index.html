<html lang='sv'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <title>EY Kompassen</title>
  <script src='https://cdn.jsdelivr.net/npm/chart.js'></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to right, #e0f7fa, #fff);
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      text-align: center;
    }
    h1 {
      font-size: 1.8em;
      margin-bottom: 10px;
    }
    .question {
      margin-bottom: 30px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s ease;
    }
    .question.active {
      opacity: 1;
      transform: translateY(0);
    }
    select {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 1em;
    }
    button {
      background-color: #00796b;
      color: white;
      padding: 12px 20px;
      font-size: 1em;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 20px 10px 0 10px;
    }
    button:hover {
      background-color: #004d40;
    }
    .result {
      margin-top: 40px;
      }
    #progressBar {
      width: 100%;
      background-color: #ddd;
      border-radius: 10px;
      overflow: hidden;
      height: 20px;
      margin-top: 20px;
    }
    #progressBarFill {
      height: 100%;
      width: 0;
      background-color: #00796b;
      transition: width 0.3s ease;
      color: white;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    #intro {
      display: block;
      text-align: center;
      padding: 60px 20px;
    }
    #intro h2 {
      font-size: 1.8em;
      margin-bottom: 10px;
    }
    #intro p {
      font-size: 1.2em;
      margin-bottom: 20px;
    }
    #warningMessage {
      display: none;
      color: red;
      font-weight: bold;
      margin-top: 20px;
      text-align: center;
    }
    @media (max-width: 600px) {
      .container {
        margin: 10px;
        padding: 15px;
      }
      h1 {
        font-size: 1.5em;
      }
      select {
        font-size: 1em;
      }
      button {
        width: 100%;
        margin: 10px 0;
      }
    }
    </style>
</head>
<body>
  <div class='container'>
    {% if not result %}
    <div id='intro'>
      <span style='font-size: 4rem; color: black;'>üß≠</span>
      <h1>EY Kompassen</h1>
      <p>Ta reda p√• var du passar b√§st in hos oss!</p>
      <button onclick='startQuiz()'>Starta testet</button>
    </div>
    {% endif %}

    <div id='quizSection' style='display:none;'>
      <span style='font-size: 4rem; color: black;'>üß≠</span>
      <h1>EY Kompassen</h1>
      <p>En fr√•ga i taget ‚Äì svara s√• noggrant du kan!</p>
      <div style='text-align:left;margin-bottom:5px;font-weight:bold;' id='questionCounter'></div>
      <div id='progressBar'><div id='progressBarFill'></div></div>
      <form id='quizForm' method='post'>
        <div id='quiz-container'>
          {% for i in questions|dictsort %}
          {% set question = i[1] %}

          <div class='question' data-question-id='{{ i }}'>
            <h2>{{ question['text'] }}</h2>
            <select name='q{{ i }}'>
              <option value='' disabled selected hidden>V√§lj ditt svar</option>
              {% for option in question['options'] %}
              <option value='{{ option['value'] }}'>{{ option['label'] }}</option>
              {% endfor %}
            </select>
          </div>
          {% endfor %}
        </div>
        <div id="warningMessage">V√§lj ett svarsalternativ innan du kan g√• vidare till n√§sta</div>
        <div>
          <button type='button' onclick='prevQuestion()' id='prevBtn' style='display:none;'>F√∂reg√•ende</button>
          <button type='button' onclick='nextQuestion()' id='nextBtn'>N√§sta</button>
          <button type='button' onclick='submitQuiz()' id='submitBtn' style='display:none;'>Se resultat</button>
        </div>
        <div style='text-align:center;'>
          <button onclick='window.location.href="/"'>G√∂r testet igen</button>
        </div>
      </form>
    </div>
    {% if result %}
    <div class='result'>
      <h2>Du matchar mest med: {{ top_match }}</h2>
      <div style='display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;'>
        {% for item in result.split() %}
          {% if ':' in item %}
            {% set label, value = item.split(':') %}
            <span style="padding: 6px 10px; border-radius: 8px; color: white; background-color:
              {% if label.lower() == 'strategy' %}rgba(255, 99, 132, 0.9)
              {% elif label.lower() == 'consulting' %}rgba(54, 162, 235, 0.9)
              {% elif label.lower() == 'assurance' %}rgba(255, 206, 86, 0.9)
              {% elif label.lower() == 'tax' %}rgba(75, 192, 192, 0.9)
              {% else %}gray{% endif %};">
              {% if label == 'strategy' %}Strategy & Transactions{% elif label == 'tax' %}Tax & Law{% else %}{{ label }}{% endif %}: {{ value }}%
            </span>
          {% endif %}
        {% endfor %}
      </div>
      <canvas id='resultChart' width='160' height='160' style='display:block; margin: 20px auto;'></canvas>
      <div style='margin-top: 30px; text-align: left;'>
  {% set descriptions = {
    'strategy': "<strong>Strategy & Transactions:</strong> Du √§r analytisk, m√•linriktad och gillar att t√§nka l√•ngsiktigt. Strategy inom EY fokuserar p√• att hj√§lpa f√∂retag fatta viktiga aff√§rsbeslut och utforma framtidsstrategier. Du kan komma att arbeta med f√∂retagsf√∂rv√§rv, aff√§rsmodeller, marknadsanalyser eller transformationsprojekt p√• h√∂g niv√•.",
    'consulting': "<strong>Consulting:</strong> Du √§r kommunikativ, kreativ och gillar variation. Consulting inneb√§r att hj√§lpa organisationer f√∂rb√§ttra sin verksamhet, ofta genom digitalisering, f√∂r√§ndringsledning eller processoptimering. Du samarbetar n√§ra kunder och driver f√∂r√§ndring inom omr√•den som teknik, HR, ekonomi eller h√•llbarhet.",
    'assurance': "<strong>Assurance:</strong> Du √§r noggrann, strukturerad och gillar att saker blir r√§tt. Inom Assurance arbetar du ofta med revision och kvalitetss√§kring av finansiell information. Du hj√§lper f√∂retag skapa f√∂rtroende genom att granska √•rsredovisningar, interna kontroller och s√§kerst√§lla att allt f√∂ljer lagar och regler.",
    'tax': "<strong>Tax & Law:</strong> Du √§r detaljfokuserad, systematisk och gillar att f√∂rst√• regler och lagar. Tax inneb√§r att hj√§lpa f√∂retag och privatpersoner navigera i skattesystemet. Du kan arbeta med nationell och internationell beskattning, moms, transaktioner eller h√•llbar skattekonsultation i en st√§ndigt f√∂r√§nderlig omv√§rld."
  } %}
  {% for item in result.split() %}
    {% set label = item.split(':')[0].lower() %}
    {% if label in descriptions %}
      <div style="padding: 12px; margin-bottom: 12px; border-radius: 8px; color: white; background-color:
        {% if label == 'strategy' %}rgba(255, 99, 132, 0.9)
        {% elif label == 'consulting' %}rgba(54, 162, 235, 0.9)
        {% elif label == 'assurance' %}rgba(255, 206, 86, 0.9)
        {% elif label == 'tax' %}rgba(75, 192, 192, 0.9)
        {% else %}gray{% endif %};">
  {{ descriptions[label]|safe }}
</div>
    {% endif %}
  {% endfor %}
</div>
      <br>
      <button onclick='window.location.href="/"'>G√∂r testet igen</button>
    </div>
    <script>
      const data = {{ chart_data | safe }};
      const ctx = document.getElementById('resultChart').getContext('2d');
      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: Object.keys(data),
          datasets: [{
            data: Object.values(data),
            backgroundColor: [
              'rgba(255, 99, 132, 0.9)',
              'rgba(54, 162, 235, 0.9)',
              'rgba(255, 206, 86, 0.9)',
              'rgba(75, 192, 192, 0.9)'
            ],
            borderColor: [
              'rgba(255, 99, 132, 1)',
              'rgba(54, 162, 235, 1)',
              'rgba(255, 206, 86, 1)',
              'rgba(75, 192, 192, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false }
          }
        }
      });
    </script>
    {% endif %}
  </div>
  <script>
    function startQuiz() {
      document.getElementById('intro').style.display = 'none';
      document.getElementById('quizSection').style.display = 'block';
      updateView();
      }
    let currentQuestion = 0;
    const questions = document.querySelectorAll('#quiz-container .question');
    const nextButton = document.getElementById('nextBtn');
    const prevButton = document.getElementById('prevBtn');
    const submitButton = document.getElementById('submitBtn');
    const progressFill = document.getElementById('progressBarFill');
    questions.forEach(q => {
      const select = q.querySelector('select');
      select.addEventListener('change', () => {
        document.getElementById('warningMessage').style.display = 'none';
      });
    });
    function updateView() {
      questions.forEach((q, i) => {
        q.classList.remove('active');
        q.style.display = 'none';
        if (i === currentQuestion) {
          q.style.display = 'block';
          setTimeout(() => q.classList.add('active'), 10);
        }
      });
      prevButton.style.display = currentQuestion > 0 ? 'inline-block' : 'none';
      nextButton.style.display = currentQuestion < questions.length - 1 ? 'inline-block' : 'none';
      submitButton.style.display = currentQuestion === questions.length - 1 ? 'inline-block' : 'none';
      progressFill.style.width = ((currentQuestion + 1) / questions.length * 100) + '%';
      document.getElementById('questionCounter').innerText = `Fr√•ga ${currentQuestion + 1} av ${questions.length}`;
    }
    function nextQuestion() {
      const currentSelect = questions[currentQuestion].querySelector('select');
      const warning = document.getElementById('warningMessage');
      if (!currentSelect.value) {
        warning.style.display = 'block';
        return;
      }
      warning.style.display = 'none';
      if (currentQuestion < questions.length - 1) {
        currentQuestion++;
        updateView();
      }
    }
    function prevQuestion() {
      if (currentQuestion > 0) {
        currentQuestion--;
        updateView();
      }
    }
    function submitQuiz() {
      const currentSelect = questions[currentQuestion].querySelector('select');
      const warning = document.getElementById('warningMessage');
      if (!currentSelect.value) {
        warning.style.display = 'block';
        return;
      }
      warning.style.display = 'none';
      document.getElementById('quizForm').submit();
    }
  </script>
</body>
</html>
